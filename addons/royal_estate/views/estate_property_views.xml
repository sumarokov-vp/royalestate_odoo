<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="estate_property_view_form" model="ir.ui.view">
        <field name="name">estate.property.form</field>
        <field name="model">estate.property</field>
        <field name="arch" type="xml">
            <form string="Объект">
                <header>
                    <field name="state" widget="statusbar" statusbar_visible="new,active,deposit,deal"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Название объекта..."/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="property_type"/>
                            <field name="deal_type"/>
                            <field name="price"/>
                            <field name="currency_id" invisible="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Основное" name="main">
                            <group>
                                <group string="Параметры">
                                    <field name="rooms" invisible="property_type == 'land'"/>
                                    <field name="bedrooms" invisible="property_type == 'land'"/>
                                    <field name="area_total"/>
                                    <field name="area_living" invisible="property_type not in ('apartment', 'house')"/>
                                    <field name="area_kitchen" invisible="property_type not in ('apartment', 'house')"/>
                                    <field name="area_land" invisible="property_type not in ('house', 'townhouse', 'commercial', 'land')"/>
                                    <field name="area_commercial" invisible="property_type != 'commercial'"/>
                                    <field name="area_warehouse" invisible="property_type != 'commercial'"/>
                                </group>
                                <group string="Здание" invisible="property_type == 'land'">
                                    <field name="floor" invisible="property_type not in ('apartment', 'commercial')"/>
                                    <field name="floors_total" invisible="property_type == 'land'"/>
                                    <field name="year_built"/>
                                    <field name="building_type" invisible="property_type not in ('apartment', 'house', 'townhouse')"/>
                                    <field name="ceiling_height" invisible="property_type == 'land'"/>
                                    <field name="entrance" invisible="property_type not in ('apartment', 'townhouse')"/>
                                    <field name="wall_material" invisible="property_type not in ('apartment', 'house', 'townhouse', 'commercial')"/>
                                </group>
                            </group>
                            <group>
                                <group string="Дом" invisible="property_type != 'house'">
                                    <field name="roof_type"/>
                                    <field name="foundation"/>
                                </group>
                                <group string="Коммерция" invisible="property_type != 'commercial'">
                                    <field name="commercial_type"/>
                                    <field name="has_showcase"/>
                                    <field name="separate_entrance"/>
                                </group>
                                <group string="Земля" invisible="property_type != 'land'">
                                    <field name="land_category"/>
                                    <field name="land_status"/>
                                    <field name="communications_nearby"/>
                                    <field name="road_access"/>
                                </group>
                            </group>
                            <group string="Описание">
                                <field name="description" nolabel="1" colspan="2"/>
                            </group>
                        </page>
                        <page string="Расположение" name="location">
                            <group>
                                <group string="Адрес">
                                    <field name="city_id"/>
                                    <label for="district_id"/>
                                    <div class="o_row">
                                        <field name="district_id"/>
                                        <button name="action_detect_district"
                                                type="object"
                                                string="Определить"
                                                class="btn-link"
                                                icon="fa-map-marker"/>
                                    </div>
                                    <field name="street_id"/>
                                    <field name="house_number"/>
                                    <field name="apartment_number" invisible="property_type not in ('apartment', 'commercial')"/>
                                </group>
                                <group string="Координаты">
                                    <field name="latitude"/>
                                    <field name="longitude"/>
                                    <field name="geo_address" readonly="1"/>
                                </group>
                            </group>
                            <field name="latitude" widget="location_map" nolabel="1"/>
                        </page>
                        <page string="Характеристики" name="features" invisible="property_type == 'land'">
                            <group>
                                <group string="Комфорт">
                                    <field name="bathroom" invisible="property_type == 'commercial'"/>
                                    <field name="bathroom_count" invisible="property_type == 'commercial'"/>
                                    <field name="balcony" invisible="property_type not in ('apartment', 'townhouse')"/>
                                    <field name="balcony_glazed" invisible="property_type not in ('apartment', 'townhouse')"/>
                                    <field name="parking"/>
                                    <field name="parking_count"/>
                                    <field name="furniture" invisible="property_type == 'commercial'"/>
                                    <field name="condition" invisible="property_type == 'land'"/>
                                </group>
                                <group string="Особенности">
                                    <field name="window_type" invisible="property_type == 'commercial'"/>
                                    <field name="climate_equipment_ids" widget="many2many_tags"/>
                                    <field name="not_corner" invisible="property_type not in ('apartment', 'townhouse')"/>
                                    <field name="isolated_rooms" invisible="property_type not in ('apartment', 'townhouse')"/>
                                    <field name="storage" invisible="property_type not in ('apartment', 'townhouse')"/>
                                    <field name="quiet_yard" invisible="property_type not in ('apartment', 'townhouse')"/>
                                    <field name="kitchen_studio" invisible="property_type not in ('apartment', 'townhouse')"/>
                                    <field name="new_plumbing" invisible="property_type == 'commercial'"/>
                                    <field name="built_in_kitchen" invisible="property_type == 'commercial'"/>
                                </group>
                            </group>
                            <group>
                                <group string="Коммуникации">
                                    <field name="heating"/>
                                    <field name="water"/>
                                    <field name="sewage"/>
                                    <field name="gas"/>
                                    <field name="electricity" invisible="property_type == 'apartment'"/>
                                    <field name="electricity_power"/>
                                    <field name="internet"/>
                                </group>
                                <group string="Безопасность">
                                    <field name="security_intercom" invisible="property_type not in ('apartment', 'townhouse')"/>
                                    <field name="security_alarm"/>
                                    <field name="security_guard" invisible="property_type == 'house'"/>
                                    <field name="security_concierge" invisible="property_type not in ('apartment', 'townhouse')"/>
                                    <field name="security_video"/>
                                    <field name="security_coded_lock" invisible="property_type not in ('apartment', 'townhouse')"/>
                                    <field name="security_fire_alarm"/>
                                </group>
                            </group>
                            <group string="Бытовая техника">
                                <field name="appliance_ids" widget="many2many_checkboxes" nolabel="1"/>
                            </group>
                        </page>
                        <page string="Юридическое" name="legal">
                            <group>
                                <group string="Собственник">
                                    <field name="owner_id"/>
                                    <field name="owner_name"/>
                                    <field name="source_id"/>
                                    <field name="krisha_url" widget="url"/>
                                </group>
                                <group string="Договор">
                                    <field name="contract_type"/>
                                    <field name="contract_start"/>
                                    <field name="contract_end"/>
                                </group>
                            </group>
                            <group>
                                <group string="Право собственности">
                                    <field name="ownership_type"/>
                                    <field name="is_pledged"/>
                                    <field name="encumbrance"/>
                                    <field name="is_privatized" invisible="property_type != 'apartment'"/>
                                    <field name="documents_ready"/>
                                </group>
                            </group>
                        </page>
                        <page string="Медиа" name="media">
                            <group>
                                <group>
                                    <field name="video_url" widget="url"/>
                                    <field name="instagram_url" widget="url"/>
                                </group>
                            </group>
                            <field name="image_ids" widget="image_gallery"/>
                        </page>
                        <page string="Служебное" name="service">
                            <group>
                                <group string="Ответственные">
                                    <field name="user_id"/>
                                    <field name="listing_coordinator_id"/>
                                    <field name="listing_agent_id"/>
                                </group>
                                <group string="Настройки">
                                    <field name="is_shared"/>
                                    <field name="active"/>
                                </group>
                            </group>
                            <group string="Внутренние заметки">
                                <field name="internal_note" nolabel="1" colspan="2"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <record id="estate_property_view_list" model="ir.ui.view">
        <field name="name">estate.property.list</field>
        <field name="model">estate.property</field>
        <field name="arch" type="xml">
            <list string="Объекты" decoration-success="state == 'active'" decoration-warning="state == 'deposit'" decoration-info="state == 'deal'" decoration-muted="state in ('canceled', 'archived')">
                <field name="name"/>
                <field name="property_type"/>
                <field name="deal_type"/>
                <field name="rooms"/>
                <field name="area_total"/>
                <field name="floor" optional="show"/>
                <field name="price"/>
                <field name="district_id"/>
                <field name="condition" optional="hide"/>
                <field name="user_id" optional="hide"/>
                <field name="state"/>
            </list>
        </field>
    </record>

    <record id="estate_property_view_search" model="ir.ui.view">
        <field name="name">estate.property.search</field>
        <field name="model">estate.property</field>
        <field name="arch" type="xml">
            <search string="Поиск объектов">
                <field name="name"/>
                <field name="city_id"/>
                <field name="district_id"/>
                <field name="street_id"/>
                <field name="owner_id"/>
                <field name="user_id"/>
                <separator/>
                <filter name="my_properties" string="Мои объекты" domain="[('user_id', '=', uid)]"/>
                <separator/>
                <filter name="apartments" string="Квартиры" domain="[('property_type', '=', 'apartment')]"/>
                <filter name="houses" string="Дома" domain="[('property_type', '=', 'house')]"/>
                <filter name="townhouses" string="Таунхаусы" domain="[('property_type', '=', 'townhouse')]"/>
                <filter name="commercial" string="Коммерция" domain="[('property_type', '=', 'commercial')]"/>
                <filter name="land" string="Земля" domain="[('property_type', '=', 'land')]"/>
                <separator/>
                <filter name="sale" string="Продажа" domain="[('deal_type', '=', 'sale')]"/>
                <filter name="rent" string="Аренда" domain="[('deal_type', 'in', ['rent_long', 'rent_daily'])]"/>
                <separator/>
                <filter name="active_state" string="В работе" domain="[('state', '=', 'active')]"/>
                <filter name="archived" string="Архив" domain="[('active', '=', False)]"/>
                <separator/>
                <filter name="group_type" string="Тип объекта" context="{'group_by': 'property_type'}"/>
                <filter name="group_deal" string="Тип сделки" context="{'group_by': 'deal_type'}"/>
                <filter name="group_district" string="Район" context="{'group_by': 'district_id'}"/>
                <filter name="group_state" string="Стадия" context="{'group_by': 'state'}"/>
                <filter name="group_user" string="Ответственный" context="{'group_by': 'user_id'}"/>
            </search>
        </field>
    </record>

    <record id="estate_property_view_kanban" model="ir.ui.view">
        <field name="name">estate.property.kanban</field>
        <field name="model">estate.property</field>
        <field name="arch" type="xml">
            <kanban default_group_by="state">
                <field name="name"/>
                <field name="property_type"/>
                <field name="price"/>
                <field name="rooms"/>
                <field name="area_total"/>
                <field name="floor"/>
                <field name="district_id"/>
                <field name="state"/>
                <templates>
                    <t t-name="card">
                        <field name="name" class="fw-bold fs-5"/>
                        <div class="text-muted">
                            <field name="district_id"/>
                        </div>
                        <div>
                            <span t-if="record.rooms.raw_value"><field name="rooms"/> комн., </span>
                            <field name="area_total"/> м²
                            <span t-if="record.floor.raw_value">, <field name="floor"/> эт.</span>
                        </div>
                        <div class="fw-bold">
                            <field name="price" widget="monetary"/>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="estate_property_action" model="ir.actions.act_window">
        <field name="name">Объекты</field>
        <field name="res_model">estate.property</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="context">{'search_default_active_state': 1}</field>
    </record>
</odoo>
