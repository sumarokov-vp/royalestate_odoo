<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils: https://docutils.sourceforge.io/" />
<title>README.rst</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 9511 2024-01-13 09:50:07Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.
Despite the name, some widely supported CSS2 features are used.

See https://docutils.sourceforge.io/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: gray; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic, pre.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<a class="reference external image-reference" href="https://odoo-community.org/get-involved?utm_source=readme">
<img alt="Odoo Community Association" src="https://odoo-community.org/readme-banner-image" />
</a>
<div class="section" id="fs-folder">
<h1>Fs Folder</h1>
<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!! This file is generated by oca-gen-addon-readme !!
!! changes will be overwritten.                   !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!! source digest: sha256:4085455207c434600a5db8b91a0ae7f89808a7061387200fa7147fda9e52715c
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
<p><a class="reference external image-reference" href="https://odoo-community.org/page/development-status"><img alt="Beta" src="https://img.shields.io/badge/maturity-Beta-yellow.png" /></a> <a class="reference external image-reference" href="http://www.gnu.org/licenses/lgpl-3.0-standalone.html"><img alt="License: LGPL-3" src="https://img.shields.io/badge/license-LGPL--3-blue.png" /></a> <a class="reference external image-reference" href="https://github.com/OCA/storage/tree/18.0/fs_folder"><img alt="OCA/storage" src="https://img.shields.io/badge/github-OCA%2Fstorage-lightgray.png?logo=github" /></a> <a class="reference external image-reference" href="https://translation.odoo-community.org/projects/storage-18-0/storage-18-0-fs_folder"><img alt="Translate me on Weblate" src="https://img.shields.io/badge/weblate-Translate%20me-F47D42.png" /></a> <a class="reference external image-reference" href="https://runboat.odoo-community.org/builds?repo=OCA/storage&amp;target_branch=18.0"><img alt="Try me on Runboat" src="https://img.shields.io/badge/runboat-Try%20me-875A7B.png" /></a></p>
<p>If you need to link some specific models to a specific folder into an
external filesystem and be able to manage the content of this folder
from the model form view, this module is for you.</p>
<p><strong>Table of contents</strong></p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#use-cases-context" id="toc-entry-1">Use Cases / Context</a></li>
<li><a class="reference internal" href="#usage" id="toc-entry-2">Usage</a><ul>
<li><a class="reference internal" href="#field-declaration" id="toc-entry-3">Field declaration</a></li>
<li><a class="reference internal" href="#security" id="toc-entry-4">Security</a><ul>
<li><a class="reference internal" href="#in-the-python-code" id="toc-entry-5">In the python code</a></li>
<li><a class="reference internal" href="#in-the-form-view-through-widget" id="toc-entry-6">In the form view through widget</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interacting-with-the-filesystem" id="toc-entry-7">Interacting with the filesystem</a></li>
<li><a class="reference internal" href="#customizing-the-field-behavior" id="toc-entry-8">Customizing the field behavior</a><ul>
<li><a class="reference internal" href="#folder-name-conformity" id="toc-entry-9">Folder name conformity</a></li>
<li><a class="reference internal" href="#other-customizations" id="toc-entry-10">Other customizations</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#bug-tracker" id="toc-entry-11">Bug Tracker</a></li>
<li><a class="reference internal" href="#credits" id="toc-entry-12">Credits</a><ul>
<li><a class="reference internal" href="#authors" id="toc-entry-13">Authors</a></li>
<li><a class="reference internal" href="#contributors" id="toc-entry-14">Contributors</a></li>
<li><a class="reference internal" href="#other-credits" id="toc-entry-15">Other credits</a></li>
<li><a class="reference internal" href="#maintainers" id="toc-entry-16">Maintainers</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="use-cases-context">
<h2><a class="toc-backref" href="#toc-entry-1">Use Cases / Context</a></h2>
<p>Some organizations have a need to manage documents in an external
filesystem next to odoo records. This module provides a generic way to
do it through the use of a specialized field <tt class="docutils literal">FsFolder</tt> that can be
used in any Odoo model.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#toc-entry-2">Usage</a></h2>
<p>The module is a technical module providing a new field type to Odoo. It
is not intended to be used directly by end-users. It is intended to be
used by developers to create new modules that need to manage files in an
external filesystem.</p>
<p>The <strong>FsFolder</strong> field type is a specialized field type that can be used
in any Odoo model. When an Odoo developer declares a field of this type
on a model and the related form view, the field will display a
specialized widget that allows the user to interact with a folder in an
external filesystem.</p>
<p>The field is linked to a filesystem backend that must be configured in
Odoo. The backend configuration is available in the ‘Settings’ -&gt;
‘Technical’ -&gt; ‘FS Storage’ menu. It is possible to define a default
backend for all the fields of this type in the Odoo configuration or to
define a specific backend for each model or field.</p>
<p>In the following documentation, we will see:</p>
<ul class="simple">
<li>how to declare a field of this type in a model</li>
<li>how the security is managed</li>
<li>how you can interact with the filesystem</li>
<li>how you can customize the field behavior</li>
</ul>
<div class="section" id="field-declaration">
<h3><a class="toc-backref" href="#toc-entry-3">Field declaration</a></h3>
<p>To declare a field of this type in a model, you need to import the field
type and declare it in the model definition. By default, the field
declaration requires no parampeters.</p>
<pre class="code python literal-block">
<span class="kn">from</span><span class="w"> </span><span class="nn">odoo</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span><span class="w">
</span><span class="kn">from</span><span class="w"> </span><span class="nn">odoo.addons.fs_folder</span><span class="w"> </span><span class="kn">import</span> <span class="n">fields</span> <span class="k">as</span> <span class="n">fs_fields</span><span class="w">

</span><span class="k">class</span><span class="w"> </span><span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span><span class="w">
</span>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">'my.model'</span><span class="w">

</span>    <span class="n">fs_folder_field</span> <span class="o">=</span> <span class="n">fs_fields</span><span class="o">.</span><span class="n">FsFolder</span><span class="p">()</span>
</pre>
<p>The new field type comes with a specific way to initialize the field.
Even if the field is not yet initialized, the value of the field will be
an instance of the <tt class="docutils literal">FsFolderValue</tt> class. But as for empty recordsets
in Odoo, the value will be considered as <tt class="docutils literal">False</tt> in a boolean context
or <tt class="docutils literal">None</tt> in a null context.</p>
<pre class="code python literal-block">
<span class="kn">from</span><span class="w"> </span><span class="nn">odoo.addons.fs_folder.fields</span><span class="w"> </span><span class="kn">import</span> <span class="n">FsFolderValue</span><span class="w">

</span><span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">'my.model'</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({})</span><span class="w">
</span><span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">fs_folder_field</span><span class="p">,</span> <span class="n">FsFolderValue</span><span class="p">)</span><span class="w">
</span><span class="k">assert</span> <span class="ow">not</span> <span class="n">record</span><span class="o">.</span><span class="n">fs_folder_field</span><span class="w">
</span><span class="k">assert</span> <span class="n">record</span><span class="o">.</span><span class="n">fs_folder_field</span> <span class="ow">is</span> <span class="kc">None</span>
</pre>
<p>To initialize the field, you can call the <tt class="docutils literal">initialize</tt> method on the
field value. This method will create the folder in the filesystem if it
does not exist yet.</p>
<pre class="code python literal-block">
<span class="n">record</span><span class="o">.</span><span class="n">fs_folder_field</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</pre>
<p>The creation of the folder in the filesystem requires 2 informations:</p>
<ul class="simple">
<li>The path where the folder will be created</li>
<li>The name of the folder</li>
</ul>
<p>By default, the path is the root folder of the filesystem. In some cases
you may want to create the folder in a specific subfolder of the
filesystem depending on the record data (or not). In this case, you can
define into the field definition a method that will be called to get the
path where the folder will be created.</p>
<pre class="code python literal-block">
<span class="kn">import</span><span class="w"> </span><span class="nn">fsspec</span><span class="w">

</span><span class="k">class</span><span class="w"> </span><span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span><span class="w">
</span>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">'my.model'</span><span class="w">

</span>    <span class="n">fs_folder_field</span> <span class="o">=</span> <span class="n">fs_fields</span><span class="o">.</span><span class="n">FsFolder</span><span class="p">(</span><span class="w">
</span>        <span class="n">create_parent_get</span><span class="o">=</span><span class="s1">'get_folder_path'</span><span class="p">,</span><span class="w">
</span>    <span class="p">)</span><span class="w">

</span>    <span class="k">def</span><span class="w"> </span><span class="nf">get_folder_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">:</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">AbstractFileSystem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span><span class="w">
</span>        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span><span class="w">
</span>        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span><span class="w">
</span>            <span class="n">result</span><span class="p">[</span><span class="n">record</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'my'</span><span class="p">,</span> <span class="s1">'subfolder'</span><span class="p">]</span><span class="w">
</span>        <span class="k">return</span> <span class="n">result</span>
</pre>
<p>In this example, the <tt class="docutils literal">get_folder_path</tt> method will be called to get
the path where the folder will be created. The method must return a
dictionary where the key is the record id and the value is a list of
strings representing the path where the folder will be created. (The
list of strings will be joined with the approprisate separator defined
by the specific filesystem used to create the folder).</p>
<p>In the same way, you can define a method to get the folder name (by
default the folder name is the record display name).</p>
<pre class="code python literal-block">
<span class="k">class</span><span class="w"> </span><span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span><span class="w">
</span>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">'my.model'</span><span class="w">

</span>    <span class="n">reference</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="w">

</span>    <span class="n">fs_folder_field</span> <span class="o">=</span> <span class="n">fs_fields</span><span class="o">.</span><span class="n">FsFolder</span><span class="p">(</span><span class="w">
</span>        <span class="n">create_name_get</span><span class="o">=</span><span class="s1">'get_folder_name'</span><span class="p">,</span><span class="w">
</span>    <span class="p">)</span><span class="w">

</span>    <span class="k">def</span><span class="w"> </span><span class="nf">get_folder_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">:</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">AbstractFileSystem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span><span class="w">
</span>        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span><span class="w">
</span>        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span><span class="w">
</span>            <span class="n">result</span><span class="p">[</span><span class="n">record</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">reference</span><span class="w">
</span>        <span class="k">return</span> <span class="n">result</span>
</pre>
<p>In this example, the <tt class="docutils literal">get_folder_name</tt> method will be called to get
the folder name. The method must return a dictionary where the key is
the record id and the value is the folder name.</p>
<p>For advanced use cases, you can also define the method that will ensure
the creation of the folder in the filesystem and assign the value to the
field. This method must return a list of <tt class="docutils literal">FsFolderValue</tt>.</p>
<pre class="code python literal-block">
<span class="k">class</span><span class="w"> </span><span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span><span class="w">
</span>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">'my.model'</span><span class="w">

</span>    <span class="n">reference</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="w">

</span>    <span class="n">fs_folder_field</span> <span class="o">=</span> <span class="n">fs_fields</span><span class="o">.</span><span class="n">FsFolder</span><span class="p">(</span><span class="w">
</span>        <span class="n">create_get</span><span class="o">=</span><span class="s1">'create_folder'</span><span class="p">,</span><span class="w">
</span>    <span class="p">)</span><span class="w">

</span>    <span class="k">def</span><span class="w"> </span><span class="nf">create_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fs</span><span class="p">:</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">AbstractFileSystem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">FsFolderValue</span><span class="p">]:</span><span class="w">
</span>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span><span class="w">
</span>        <span class="n">value_adapter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s2">&quot;fs.folder.field.value.adapter&quot;</span><span class="p">]</span><span class="w">
</span>        <span class="n">storage_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="w">
</span>                <span class="s2">&quot;fs.storage&quot;</span><span class="w">
</span>            <span class="p">]</span><span class="o">.</span><span class="n">get_default_storage_code_for_fs_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="s1">'fs_folder_field'</span><span class="p">)</span><span class="w">
</span>        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span><span class="w">
</span>            <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'my/subfolder/</span><span class="si">{</span><span class="n">record</span><span class="o">.</span><span class="n">reference</span><span class="si">}</span><span class="s1">'</span><span class="w">
</span>            <span class="n">fs</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="w">
</span>            <span class="n">record</span><span class="o">.</span><span class="n">fs_folder_field</span> <span class="o">=</span> <span class="n">value_adapter</span><span class="o">.</span><span class="n">_created_folder_name_to_stored_value</span><span class="p">(</span><span class="w">
</span>                <span class="n">path</span><span class="p">,</span> <span class="n">storage_code</span><span class="p">,</span> <span class="n">fs</span><span class="w">
</span>            <span class="p">)</span><span class="w">
</span>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">fs_folder_field</span><span class="p">)</span><span class="w">
</span>        <span class="k">return</span> <span class="n">result</span>
</pre>
<p>Last but not least, 2 additional method hooks are available to customize
the behavior of the field:</p>
<ul class="simple">
<li>create_additional_kwargs_get: This method will be called to get
additional keyword arguments to pass to the <tt class="docutils literal">fs.mkdir</tt> method when
creating the folder.</li>
<li>create_post_process: This method will be called after the folder
creation to do some additional processing.</li>
</ul>
</div>
<div class="section" id="security">
<h3><a class="toc-backref" href="#toc-entry-4">Security</a></h3>
<blockquote>
<strong>Important:</strong> The security of the field should be managed by the
filesystem backend.</blockquote>
<div class="section" id="in-the-python-code">
<h4><a class="toc-backref" href="#toc-entry-5">In the python code</a></h4>
<p>The initialization of the field value is only allowed if the user has
write access to the record. From the field value, the user can get
access to the filesystem client and interact with the filesystem. The
filesystem is rooted in the folder itself. The user can only interact
with the folder and its children without being able to go up in the
filesystem.</p>
</div>
<div class="section" id="in-the-form-view-through-widget">
<h4><a class="toc-backref" href="#toc-entry-6">In the form view through widget</a></h4>
<p>The addon comes with a specific widget that will be used to display the
field in the form view. The widget will display the folder content and
allow the user to interact with it. The user can create, delete, rename,
download and upload files and folders. The user can also navigate into
the filesystem. All theses operations are made available by methods
provided by the abstract model ‘fs.folder.field.web.api’. A first level
of security is provided by this API. Any operation modifying the
filesystem will allowed only if the user has write access to the record
and any operation reading the filesystem will be allowed only if the
user has read access to the record.</p>
</div>
</div>
<div class="section" id="interacting-with-the-filesystem">
<h3><a class="toc-backref" href="#toc-entry-7">Interacting with the filesystem</a></h3>
<p>To interact with the filesystem you can simply use the filesystem client
provided by the field value.</p>
<pre class="code python literal-block">
<span class="n">record</span><span class="o">.</span><span class="n">fs_folder_field</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">'my/subfolder'</span><span class="p">)</span><span class="w">
</span><span class="k">with</span> <span class="n">record</span><span class="o">.</span><span class="n">fs_folder_field</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'my/subfolder/myfile.txt'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span><span class="w">
</span>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'Hello, world!'</span><span class="p">)</span>
</pre>
<p>The api also provides higl-level methods to interact with the filesystem
and ease the access to the files. For example, if you need to provide a
download link to a file, you can use the <tt class="docutils literal">get_url_for_download</tt> method
from the abstract model ‘fs.folder.field.web.api’.</p>
<pre class="code python literal-block">
<span class="n">api</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">'fs.folder.field.web.api'</span><span class="p">]</span><span class="w">
</span><span class="n">url</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">get_url_for_download</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>  <span class="n">record</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="s2">&quot;fs_folder_field&quot;</span><span class="p">,</span> <span class="s1">'my/subfolder/myfile.txt'</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="customizing-the-field-behavior">
<h3><a class="toc-backref" href="#toc-entry-8">Customizing the field behavior</a></h3>
<p>As specified above, you can define some methods to customize the field
behavior. During the process of creating a directory in a filesystem, 1
additional mechanism comes into play to guarantee the conformity of the
directory created.</p>
<div class="section" id="folder-name-conformity">
<h4><a class="toc-backref" href="#toc-entry-9">Folder name conformity</a></h4>
<p>When it comes to creating a folder in the filesystem, we must prevent
the use of special characters that could cause problems. This is done by
default by the field when creating the folder by replacing the
characters that are not allowed by the filesystem by an underscore. You
can control this behavior on the ‘fs.storage’ form view. A field is
available to disable this behavior and another one to define the
character to use as a replacement. If the behavior is disabled, the
field will raise an error if the folder name is not conform. (This
applies to the full path of the folder).</p>
</div>
<div class="section" id="other-customizations">
<h4><a class="toc-backref" href="#toc-entry-10">Other customizations</a></h4>
<p>In addition you can:</p>
<ul class="simple">
<li>override the adapter that will be used to convert the field value to a
stored value and vice versa. The adapter is a model that must extend
the ‘fs.folder.field.value.adapter’ abstract model.</li>
<li>extend/override the api model used by the widget to interact with the
filesystem. The api model must extend the ‘fs.folder.field.web.api’
abstract model.</li>
<li>extend/override the widget itself</li>
</ul>
</div>
</div>
</div>
<div class="section" id="bug-tracker">
<h2><a class="toc-backref" href="#toc-entry-11">Bug Tracker</a></h2>
<p>Bugs are tracked on <a class="reference external" href="https://github.com/OCA/storage/issues">GitHub Issues</a>.
In case of trouble, please check there if your issue has already been reported.
If you spotted it first, help us to smash it by providing a detailed and welcomed
<a class="reference external" href="https://github.com/OCA/storage/issues/new?body=module:%20fs_folder%0Aversion:%2018.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**">feedback</a>.</p>
<p>Do not contact contributors directly about support or help with technical issues.</p>
</div>
<div class="section" id="credits">
<h2><a class="toc-backref" href="#toc-entry-12">Credits</a></h2>
<div class="section" id="authors">
<h3><a class="toc-backref" href="#toc-entry-13">Authors</a></h3>
<ul class="simple">
<li>ACSONE SA/NV</li>
</ul>
</div>
<div class="section" id="contributors">
<h3><a class="toc-backref" href="#toc-entry-14">Contributors</a></h3>
<ul class="simple">
<li>Laurent Mignon <a class="reference external" href="mailto:laurent.mignon&#64;acsone.eu">laurent.mignon&#64;acsone.eu</a></li>
<li>Enric Tobella Alomar <a class="reference external" href="mailto:enric.tobella&#64;dixmit.com">enric.tobella&#64;dixmit.com</a></li>
</ul>
</div>
<div class="section" id="other-credits">
<h3><a class="toc-backref" href="#toc-entry-15">Other credits</a></h3>
<p>The development of this module has been financially supported by:</p>
<ul class="simple">
<li>ACSONE SA/NV</li>
<li>BRUGEL (Brussels Regional Public Service for Energy)</li>
</ul>
</div>
<div class="section" id="maintainers">
<h3><a class="toc-backref" href="#toc-entry-16">Maintainers</a></h3>
<p>This module is maintained by the OCA.</p>
<a class="reference external image-reference" href="https://odoo-community.org">
<img alt="Odoo Community Association" src="https://odoo-community.org/logo.png" />
</a>
<p>OCA, or the Odoo Community Association, is a nonprofit organization whose
mission is to support the collaborative development of Odoo features and
promote its widespread use.</p>
<p>Current <a class="reference external" href="https://odoo-community.org/page/maintainer-role">maintainer</a>:</p>
<p><a class="reference external image-reference" href="https://github.com/lmignon"><img alt="lmignon" src="https://github.com/lmignon.png?size=40px" /></a></p>
<p>This module is part of the <a class="reference external" href="https://github.com/OCA/storage/tree/18.0/fs_folder">OCA/storage</a> project on GitHub.</p>
<p>You are welcome to contribute. To learn how please visit <a class="reference external" href="https://odoo-community.org/page/Contribute">https://odoo-community.org/page/Contribute</a>.</p>
</div>
</div>
</div>
</div>
</body>
</html>
